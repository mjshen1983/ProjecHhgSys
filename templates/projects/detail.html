{% extends 'base.html' %}

{% block title %}项目详情{% endblock %}

{% block content %}
<h1>{{ project.name }}（{{ project.code }}）</h1>
<div class="detail-grid">
	<div>
		<div class="detail-label">项目状态</div>
		<div class="detail-value">{{ project.status_label }}</div>
	</div>
	<div>
		<div class="detail-label">负责人</div>
		<div class="detail-value">{{ project.owner.display_name|default:project.owner.username }}</div>
	</div>
	<div>
		<div class="detail-label">牵头部门</div>
		<div class="detail-value">{{ project.lead_department|default:"--" }}</div>
	</div>
	<div>
		<div class="detail-label">开始日期</div>
		<div class="detail-value">{{ project.start_date|date:"Y-m-d" }}</div>
	</div>
	<div>
		<div class="detail-label">计划结束</div>
		<div class="detail-value">{{ project.end_date|date:"Y-m-d"|default:"--" }}</div>
	</div>
</div>
<section class="detail-section">
	<h2>项目简介</h2>
	<p>{{ project.description|default:"暂无描述" }}</p>
</section>
<section class="detail-section">
	<div class="list-toolbar">
		<h2>任务列表</h2>
		<a class="primary-button" href="{{ create_task_url }}">新建任务</a>
	</div>
	{% if tasks %}
	<div class="table-card">
		<table>
			<thead>
				<tr>
					<th>任务标题</th>
					<th>状态</th>
					<th>优先级</th>
					<th>负责人</th>
					<th>截止日期</th>
					<th>操作</th>
				</tr>
			</thead>
			<tbody>
			{% for task in tasks %}
				<tr>
					<td>{{ task.title }}</td>
					<td><span class="status-badge {{ task.status_css }}">{{ task.status_label }}</span></td>
					<td><span class="priority-badge {{ task.priority_css }}">{{ task.priority_label }}</span></td>
					<td>
						{% if task.assignee %}
							{{ task.assignee.display_name|default:task.assignee.username }}
						{% else %}
							--
						{% endif %}
					</td>
					<td>{{ task.due_date|date:"Y-m-d"|default:"--" }}</td>
					<td>
						<div class="action-group">
							<a class="header__button" href="{% url 'task_detail' task.id %}?next={{ current_path|urlencode }}">查看</a>
							<a class="header__button" href="{% url 'task_update' task.id %}?next={{ current_path|urlencode }}">编辑</a>
							<form action="{% url 'task_delete' task.id %}" method="post" class="inline-form" onsubmit="return confirm('确定删除该任务？');">
								{% csrf_token %}
								<input type="hidden" name="next" value="{{ current_path }}">
								<button type="submit" class="header__button header__button--danger">删除</button>
							</form>
						</div>
					</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</div>
	{% else %}
	<p>该项目暂未创建任务。</p>
	{% endif %}
</section>
<div class="form-actions">
	<a class="header__button" href="{% url 'project_list' %}">返回列表</a>
</div>
{% endblock %}