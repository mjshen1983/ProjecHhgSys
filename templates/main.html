{% extends 'base.html' %}

{% block title %}工作台 · 淮海集团项目管理平台{% endblock %}

{% block content %}
<div class="page-header">
	<h1>欢迎回来，{{ display_name }}</h1>
</div>
<section class="chart-section">
	<div class="chart-grid">
		<div class="chart-card">
			<div class="chart-card__header">
				<h2>项目状态</h2>
				<span class="chart-card__total">{{ project_count }} 个项目</span>
			</div>
			{% if project_status_stats %}
			<ul class="chart-list">
				{% for stat in project_status_stats %}
				<li class="chart-list__item">
					<div class="chart-list__header">
						<span>{{ stat.label }}</span>
						<span class="chart-list__value">{{ stat.count }} 个</span>
					</div>
					<progress class="chart-progress chart-progress--{{ stat.code }}" value="{{ stat.percent_value }}" max="100"></progress>
				</li>
				{% endfor %}
			</ul>
			{% else %}
			<p class="chart-card__empty">暂无项目数据。</p>
			{% endif %}
		</div>
		<div class="chart-card">
			<div class="chart-card__header">
				<h2>任务状态</h2>
				<span class="chart-card__total">{{ task_count }} 个任务</span>
			</div>
			{% if task_status_stats %}
			<ul class="chart-list">
				{% for stat in task_status_stats %}
				<li class="chart-list__item">
					<div class="chart-list__header">
						<span>{{ stat.label }}</span>
						<span class="chart-list__value">{{ stat.count }} 个</span>
					</div>
					<progress class="chart-progress chart-progress--{{ stat.code }}" value="{{ stat.percent_value }}" max="100"></progress>
				</li>
				{% endfor %}
			</ul>
			{% else %}
			<p class="chart-card__empty">暂无任务数据。</p>
			{% endif %}
		</div>
	</div>
</section>
<section class="detail-section">
	<div class="list-toolbar">
		<h2>我的待办任务</h2>
		<div class="action-group">
			<a class="header__button" href="{% url 'project_list' %}">查看项目列表</a>
			<a class="header__button" href="{% url 'task_list' %}">查看全部任务</a>
		</div>
	</div>
	{% if todo_tasks %}
	<div class="table-card">
		<table>
			<thead>
				<tr>
					<th>任务标题</th>
					<th>所属项目</th>
					<th>优先级</th>
					<th>状态</th>
					<th>截止日期</th>
					<th>操作</th>
				</tr>
			</thead>
			<tbody>
			{% for task in todo_tasks %}
				<tr>
					<td>{{ task.title }}</td>
					<td>{{ task.project.name }}</td>
					<td><span class="priority-badge {{ task.priority_css }}">{{ task.priority_label }}</span></td>
					<td><span class="status-badge {{ task.status_css }}">{{ task.status_label }}</span></td>
					<td>{{ task.due_date|date:"Y-m-d"|default:"--" }}</td>
					<td>
						<div class="action-group">
							<a class="header__button" href="{% url 'task_detail' task.id %}?next={{ current_path|urlencode }}">查看</a>
							<a class="header__button" href="{% url 'task_update' task.id %}?next={{ current_path|urlencode }}">编辑</a>
						</div>
					</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</div>
	{% else %}
	<p>暂无待办任务。</p>
	{% endif %}
</section>
{% endblock %}
