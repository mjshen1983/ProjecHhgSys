{% extends 'base.html' %}

{% block title %}项目附件 · {{ project.name }}{% endblock %}

{% block content %}
<div class="list-toolbar">
    <h1>{{ project.name }} 附件</h1>
    <div class="action-group">
        <a class="header__button" href="{% url 'project_list' %}">返回项目列表</a>
    {% if can_manage_projects %}
    <a class="header__button header__button--primary" href="{% url 'attachment_project_upload' project.id %}">上传</a>
    {% else %}
    <button type="button" class="header__button header__button--primary header__button--disabled" disabled aria-disabled="true">上传</button>
    {% endif %}
    </div>
</div>
{% if messages %}
    <ul class="message-list">
    {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
    {% endfor %}
    </ul>
{% endif %}
<div class="table-card">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>附件名称</th>
                <th>上传者</th>
                <th>上传时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
        {% for attachment in attachments %}
            <tr>
                <td>{{ attachment.id }}</td>
                <td>
                    <div>{{ attachment.name }}</div>
                    <div class="secondary-text">{{ attachment.file_basename }}{% if attachment.file_extension %}（{{ attachment.file_extension|upper }}）{% endif %}</div>
                </td>
                <td>{{ attachment.uploaded_by.display_name|default:attachment.uploaded_by.username }}</td>
                <td>{{ attachment.created_at|date:"Y-m-d H:i" }}</td>
                <td>
                    <div class="action-group">
                        <a class="header__button header__button--primary" href="{{ attachment.file.url }}" download>下载</a>
                        {% if can_manage_projects %}
                        <form class="inline-form" action="{% url 'attachment_project_delete' project.id attachment.id %}" method="post" onsubmit="return confirm('确定删除该附件？');">
                            {% csrf_token %}
                            <button type="submit" class="header__button header__button--danger">删除</button>
                        </form>
                        {% else %}
                        <button type="button" class="header__button header__button--danger header__button--disabled" disabled aria-disabled="true">删除</button>
                        {% endif %}
                    </div>
                </td>
            </tr>
        {% empty %}
            <tr><td colspan="5">暂无附件，可以点击右上角“上传附件”。</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
